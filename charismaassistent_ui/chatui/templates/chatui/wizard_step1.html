{% extends "chatui/base.html" %}
{% load static %}

{% block title %}Wizard · Step 1 · CharismaAssistant{% endblock %}

{% block content %}
<section class="card">
  <header class="card__header">
    <h2>Analysis Wizard</h2>
    <small class="muted">Step 1/2 · Enter speech text</small>
  </header>

  <div class="steps" aria-label="Wizard Steps">
    <div class="step"><span>1</span> Text</div>
    <div class="step muted" style="opacity:.7">
      <span style="background:rgba(255,255,255,.15);color:var(--text)">2</span> Analysis
    </div>
  </div>

  <div class="two-col">
    <!-- LEFT: Input -->
    <div class="col-left">
      <div class="card" style="padding:12px;">
        <div class="row" style="justify-content:space-between; gap:12px;">
          <div>
            <h3 style="margin:0 0 4px 0;">Speech text</h3>
            <small class="muted">Paste the text to analyze (English speeches; verbal CLTs only).</small>
          </div>
          <span class="badge" id="counter">0 words · 0 chars</span>
        </div>

        <div style="margin-top:10px;">
          <textarea
            id="speechText"
            class="input"
            placeholder="Paste the speech text here…"
            style="width:100%; min-height:260px;"
          ></textarea>
        </div>

        <div class="row" style="margin-top:10px;">
          <label class="row" style="gap:8px; cursor:pointer;">
            <input type="checkbox" id="enableCompare" />
            <span>Enable comparison model (Gemini)</span>
          </label>
          <span class="muted">Runs a second analysis with a different LLM.</span>
        </div>

        <!-- NEW: Hybrid option -->
        <div class="row" style="margin-top:10px;">
          <label class="row" style="gap:8px; cursor:pointer;">
            <input type="checkbox" id="enableHybrid" />
            <span>Enable hybrid mode (candidate-only)</span>
          </label>
          <span class="muted">Uses rule-based candidates; Step 2 shows live run progress.</span>
        </div>

        <div class="row" style="margin-top:10px; justify-content:space-between;">
          <div class="row">
            <button type="button" class="btn btn-ghost" id="btnClear">Clear</button>
            <button type="button" class="btn btn-dark" id="btnExample">Example text</button>
          </div>

          <div class="row">
            <button type="button" class="btn btn-okay" id="btnNext" disabled>
              Next → Step 2
            </button>
          </div>
        </div>

        <p class="muted" style="margin:10px 0 0 0;">
          Note: The text is stored locally so Step 2 can load it automatically.
        </p>
      </div>
    </div>

    <!-- RIGHT: Preview + Settings -->
    <div class="col-right sticky">
      <div class="preview-panel">
        <div class="preview-topic">
          <h4>Live preview</h4>
          <div class="muted" style="margin-bottom:8px;">
            Excerpt (first ~600 chars), exactly as it will be sent to the backend.
          </div>
          <div id="preview" class="result__text" style="min-height:140px;"></div>
        </div>

        <div class="preview-topic">
          <h4>Analysis setup</h4>
          <div class="preview-task">
            <div class="preview-task-title">CLTs</div>
            <div class="preview-task-text muted">9 verbal tactics (Antonakis et al.)</div>
          </div>
          <div class="preview-task">
            <div class="preview-task-title">Ensemble</div>
            <div class="preview-task-text muted">3 LLM runs (aggregation)</div>
          </div>
          <div class="preview-task">
            <div class="preview-task-title">Hybrid mode</div>
            <div class="preview-task-text muted">Candidate-only input to LLM (optional)</div>
          </div>
        </div>

        <div class="row" style="margin-top:12px;">
          <a class="btn btn-ghost" href="{% url 'chat' %}">← Back to chat</a>
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock %}

{% block scripts %}
<script defer src="{% static 'chatui/wizard_step1.js' %}?v=20260223-EN-HYBRID-1"></script>
{% endblock %}